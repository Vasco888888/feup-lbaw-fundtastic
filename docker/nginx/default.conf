# -----------------------------------------------------------------------------
# LBAW Laravel Application Nginx Configuration
#
# Copied into the container at:
#   /etc/nginx/conf.d/default.conf
#
# Responsibilities:
# - Serve Laravel app from /var/www/public
# - Forward PHP requests to php-fpm (port 9000)
# - Apply basic security headers
# - Block access to hidden files
# -----------------------------------------------------------------------------

server {
    listen 80;
    server_name _; # Catch-all server name (useful in Docker/containers where hostname is unknown)

    root /var/www/public;
    index index.php index.html;

    # Security headers.
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;

    # Handle Laravel front controller
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Favicon/robots: donâ€™t flood logs
    location = /favicon.ico  { access_log off; log_not_found off; }
    location = /robots.txt   { access_log off; log_not_found off; }

    # PHP-FPM (php:8.3-fpm listens on 9000 by default)
    location ~ \.php$ {
        include        fastcgi_params;
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;

        # SCRIPT_FILENAME for Laravel
        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    # Deny hidden files except .well-known
    location ~ /\.(?!well-known) {
        deny all;
    }
}
